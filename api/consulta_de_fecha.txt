 case 'listar':
         $sql = "SELECT t.*, p.nombre AS punto 
            FROM turnos t
             JOIN puntos p ON t.punto_id = p.id
            ORDER BY t.fecha, t.hora_inicio";
    $stmt = $pdo->query($sql);
    echo json_encode($stmt->fetchAll(PDO::FETCH_ASSOC));    
    break;

-- Tabla principal de turnos programados
CREATE TABLE IF NOT EXISTS turnos (
  id INT AUTO_INCREMENT PRIMARY KEY,
  fecha DATE NOT NULL,
  hora_inicio TIME NOT NULL,
  hora_fin TIME NOT NULL,
  punto_id INT NOT NULL,
  tipo ENUM('fijo','eventual','suplencia','condicional') NOT NULL DEFAULT 'eventual',
  estado ENUM('creado','abierto','asignaciones_modificadas','planificado','publicado','completado','cancelado') NOT NULL DEFAULT 'creado',
  minimo_publicadores INT DEFAULT NULL,
  maximo_publicadores INT DEFAULT NULL,
  captain_required TINYINT(1) DEFAULT 1,
  published_at TIMESTAMP NULL DEFAULT NULL,
  validated_at TIMESTAMP NULL DEFAULT NULL,
  created_by INT DEFAULT NULL, -- admin que cre√≥
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  metadata JSON DEFAULT NULL, -- para flags, tags, ratio, etc
  UNIQUE KEY uk_turno_punto_fecha_hora (punto_id, fecha, hora_inicio),
  FOREIGN KEY (punto_id) REFERENCES puntos(id) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
